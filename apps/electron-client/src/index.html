<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IMAP 테스트 클라이언트</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background-color: #f5f5f5;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      h1 {
        margin-bottom: 20px;
      }

      .section {
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid #eee;
      }

      .form-group {
        margin-bottom: 15px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }

      input[type="text"],
      input[type="email"],
      input[type="password"],
      select,
      textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }

      button {
        background-color: #4caf50;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        margin-right: 5px;
      }

      button:hover {
        background-color: #45a049;
      }

      button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
      }

      #result-area {
        background-color: #f8f8f8;
        border: 1px solid #ddd;
        padding: 15px;
        border-radius: 4px;
        max-height: 300px;
        overflow-y: auto;
        white-space: pre-wrap;
        font-family: monospace;
      }

      .email-list {
        list-style: none;
      }

      .email-item {
        padding: 10px;
        border-bottom: 1px solid #eee;
        cursor: pointer;
      }

      .email-item:hover {
        background-color: #f5f5f5;
      }

      .email-item.unread {
        font-weight: bold;
        background-color: #f0f8ff;
      }

      .email-subject {
        font-weight: bold;
      }

      .email-sender {
        color: #666;
        font-size: 0.9em;
      }

      .email-date {
        color: #999;
        font-size: 0.8em;
      }

      .email-preview {
        color: #777;
        font-size: 0.85em;
        max-height: 1.5em;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        margin-top: 5px;
      }

      .status {
        padding: 8px 12px;
        border-radius: 4px;
        margin: 10px 0;
        font-weight: bold;
        display: inline-block;
      }

      .status.success {
        background-color: #e6f4ea;
        color: #137333;
      }

      .status.error {
        background-color: #fce8e6;
        color: #c5221f;
      }

      .status.info {
        background-color: #e8f0fe;
        color: #1a73e8;
      }

      .pagination {
        display: flex;
        justify-content: center;
        margin-top: 15px;
      }

      .pagination button {
        margin: 0 5px;
        padding: 5px 10px;
      }

      .email-detail {
        margin-top: 20px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
        display: none;
      }

      .email-detail-header {
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
        margin-bottom: 10px;
      }

      .email-detail-body {
        margin-top: 15px;
        white-space: pre-wrap;
      }

      .email-attachments {
        margin-top: 15px;
        padding-top: 10px;
        border-top: 1px solid #eee;
      }

      .loading {
        text-align: center;
        padding: 20px;
        font-style: italic;
        color: #777;
      }

      .account-selector {
        margin-bottom: 15px;
      }

      .account-selector select {
        padding: 8px;
        border-radius: 4px;
        margin-right: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>in IMAP 테스트 클라이언트</h1>

      <!-- 계정 선택 UI -->
      <div id="account-selector" class="account-selector" style="display: none">
        <label for="account-select">계정 선택:</label>
        <select id="account-select"></select>
        <button id="add-account-btn">새 계정 추가</button>
      </div>

      <div id="account-section" class="section">
        <h2>계정 설정</h2>
        <form id="account-form">
          <div class="form-group">
            <label for="email">이메일 주소</label>
            <input
              type="email"
              id="email"
              placeholder="example@domain.com"
              required
            />
          </div>
          <div class="form-group">
            <label for="password">비밀번호</label>
            <input type="password" id="password" required />
          </div>
          <div class="form-group">
            <label for="imapHost">IMAP 서버</label>
            <input type="text" id="imapHost" value="imap.gmail.com" required />
          </div>
          <div class="form-group">
            <label for="imapPort">IMAP 포트</label>
            <input type="text" id="imapPort" value="993" required />
          </div>
          <div class="form-group">
            <label for="smtpHost">SMTP 서버</label>
            <input type="text" id="smtpHost" value="smtp.gmail.com" required />
          </div>
          <div class="form-group">
            <label for="smtpPort">SMTP 포트</label>
            <input type="text" id="smtpPort" value="465" required />
          </div>
          <button
            type="button"
            id="test-connection-btn"
            onclick="testConnection()"
          >
            연결 테스트
          </button>
          <button type="submit" onclick="saveAccount(event)">계정 저장</button>
        </form>
      </div>

      <div id="email-section" class="section" style="display: none">
        <h2>이메일</h2>
        <div class="form-group">
          <label for="folder">폴더</label>
          <select id="folder">
            <option value="INBOX">받은 편지함</option>
            <option value="Sent">보낸 편지함</option>
            <option value="Drafts">임시 보관함</option>
            <option value="Trash">휴지통</option>
          </select>
        </div>
        <button type="button" id="fetch-emails-btn">이메일 가져오기</button>

        <!-- 이메일 목록 컨테이너 -->
        <div id="email-list-container" style="margin-top: 15px">
          <div id="loading-emails" class="loading" style="display: none">
            이메일 로딩 중...
          </div>
          <ul class="email-list" id="email-list"></ul>

          <!-- 페이지네이션 UI -->
          <div id="pagination" class="pagination" style="display: none">
            <button id="prev-page" disabled>&laquo; 이전</button>
            <span id="page-info">1페이지</span>
            <button id="next-page">다음 &raquo;</button>
          </div>
        </div>

        <!-- 이메일 상세 보기 -->
        <div id="email-detail" class="email-detail">
          <div id="loading-email-detail" class="loading" style="display: none">
            이메일 내용 로딩 중...
          </div>
          <div id="email-detail-content">
            <div class="email-detail-header">
              <h3 id="detail-subject"></h3>
              <div id="detail-sender"></div>
              <div id="detail-recipient"></div>
              <div id="detail-date"></div>
            </div>
            <div id="email-detail-body" class="email-detail-body"></div>
            <div
              id="email-attachments"
              class="email-attachments"
              style="display: none"
            >
              <h4>첨부파일</h4>
              <ul id="attachment-list"></ul>
            </div>
          </div>
          <button id="close-detail-btn" style="margin-top: 15px">
            목록으로 돌아가기
          </button>
        </div>
      </div>

      <div id="compose-section" class="section" style="display: none">
        <h2>메일 보내기</h2>
        <form id="send-email-form">
          <div class="form-group">
            <label for="recipient">받는 사람</label>
            <input type="email" id="recipient" required />
          </div>
          <div class="form-group">
            <label for="subject">제목</label>
            <input type="text" id="subject" required />
          </div>
          <div class="form-group">
            <label for="body">내용</label>
            <textarea id="body" rows="5"></textarea>
          </div>
          <button type="submit">보내기</button>
        </form>
      </div>

      <div class="section">
        <h2>결과</h2>
        <div id="result-area">로그 출력 영역...</div>
      </div>
    </div>

    <script>
      // 전역 변수 선언
      let accountId = null;

      // 전역 함수로 선언
      window.testConnection = async function () {
        try {
          log("연결 테스트 중...");
          const accountData = getAccountData();
          console.log("계정 데이터:", accountData);

          const result = await window.api.testConnection(accountData);
          console.log("테스트 결과:", result);
          log("연결 성공!");
          log(JSON.stringify(result, null, 2));
        } catch (error) {
          console.error("연결 테스트 오류:", error);
          log("연결 실패: " + error.message);
        }
      };

      window.saveAccount = async function (event) {
        event.preventDefault();
        try {
          log("계정 저장 중...");
          const accountData = getAccountData();
          console.log("저장할 계정 데이터:", accountData);

          const result = await window.api.account.add(accountData);
          console.log("저장 결과:", result);
          accountId = result.id;

          // 계정 ID를 localStorage에 저장
          if (accountId) {
            localStorage.setItem("lastUsedAccountId", accountId);
            log("계정 저장 성공!");
            log(`계정 ID: ${accountId}`);

            // 계정 저장 성공 시 UI 전환
            accountSection.style.display = "none";
            emailSection.style.display = "block";
            composeSection.style.display = "block";

            // 모든 계정 다시 로드하여 선택기 업데이트
            const accounts = await window.api.account.getAll();
            updateAccountSelector(accounts, accountId);
            accountSelector.style.display = "block";

            // 이메일 폴더 로드
            const folders = await window.api.account.getFolders(accountId);
            updateFolderSelector(folders);

            // 첫 페이지 이메일 자동 로드
            loadEmails();
          } else {
            log(
              "계정 ID가 반환되지 않았습니다. 계정은 저장되었지만 ID 획득에 실패했습니다."
            );
          }
        } catch (error) {
          console.error("계정 저장 오류:", error);
          log("계정 저장 실패: " + error.message);
        }
      };

      document.addEventListener("DOMContentLoaded", () => {
        // 상태 변수
        let currentPage = 1;
        let totalEmails = 0;
        let pageSize = 20; // 한 페이지에 표시할 이메일 수
        let currentFolder = "INBOX";
        let selectedEmailUid = null;

        // DOM 요소 참조
        const resultArea = document.getElementById("result-area");
        const emailListContainer = document.getElementById(
          "email-list-container"
        );
        const emailList = document.getElementById("email-list");
        const emailDetail = document.getElementById("email-detail");
        const pagination = document.getElementById("pagination");
        const emailSection = document.getElementById("email-section");
        const composeSection = document.getElementById("compose-section");
        const accountSection = document.getElementById("account-section");
        const accountSelector = document.getElementById("account-selector");

        // 전역 변수에 UI 요소 할당
        window.resultArea = resultArea;
        window.emailSection = emailSection;
        window.composeSection = composeSection;
        window.accountSection = accountSection;
        window.accountSelector = accountSelector;
        // 로그 출력 함수를 전역으로 선언
        window.log = function (message) {
          const timestamp = new Date().toLocaleTimeString();
          resultArea.textContent += `[${timestamp}] ${message}\n`;
          resultArea.scrollTop = resultArea.scrollHeight;
        };

        // localStorage에서 계정 ID 가져오거나 초기화
        const initAccount = () => {
          // localStorage에서 마지막 사용 계정 ID 가져오기
          const lastUsedId = localStorage.getItem("lastUsedAccountId");
          if (lastUsedId) {
            accountId = parseInt(lastUsedId);
            return true;
          }
          return false;
        };

        // 앱 시작 시 계정 로드 함수
        async function loadAccounts() {
          try {
            // 모든 계정 가져오기
            const accounts = await window.api.account.getAll();

            if (accounts.length > 0) {
              // 계정이 있는 경우

              // 가져올 계정 ID 결정 로직:
              // 1. localStorage에 저장된 ID 사용
              // 2. 없으면 가장 최근에 추가된 계정 사용 (일반적으로 ID가 가장 큰 계정)
              // 3. 그것도 없으면 첫 번째 계정 사용 (ID 1)

              // localStorage 확인
              const hasStoredAccount = initAccount();

              if (!hasStoredAccount) {
                // 가장 큰 ID 찾기 (최근 추가된 계정)
                const lastAccount = accounts.reduce(
                  (max, account) => (account.id > max.id ? account : max),
                  accounts[0]
                );
                accountId = lastAccount.id;
                localStorage.setItem("lastUsedAccountId", accountId);
              }

              log("저장된 계정을 불러왔습니다. 계정 ID: " + accountId);

              // 계정 선택 UI 업데이트
              updateAccountSelector(accounts, accountId);

              // 계정이 있으면 이메일 섹션 표시, 계정 섹션 숨김
              accountSection.style.display = "none";
              emailSection.style.display = "block";
              composeSection.style.display = "block";
              accountSelector.style.display = "block";

              // 기본 폴더 목록 가져오기
              const folders = await window.api.account.getFolders(accountId);
              updateFolderSelector(folders);

              // 첫 페이지 이메일 자동 로드
              loadEmails();
            }
          } catch (error) {
            log("계정 로드 실패: " + error.message);
          }
        }

        // 계정 선택 UI 업데이트
        function updateAccountSelector(accounts, selectedId) {
          const select = document.getElementById("account-select");
          select.innerHTML = "";

          accounts.forEach((account) => {
            const option = document.createElement("option");
            option.value = account.id;
            option.textContent = account.email;
            option.selected = parseInt(account.id) === parseInt(selectedId);
            select.appendChild(option);
          });

          // 계정 선택 이벤트
          select.addEventListener("change", function () {
            switchAccount(parseInt(this.value));
          });

          // 새 계정 추가 버튼 이벤트
          document
            .getElementById("add-account-btn")
            .addEventListener("click", function () {
              accountSection.style.display = "block";
              accountSelector.style.display = "none";
            });
        }

        // 전역에 할당
        window.updateAccountSelector = updateAccountSelector;

        // 폴더 선택 UI 업데이트
        function updateFolderSelector(folders) {
          const select = document.getElementById("folder");

          // 기본 옵션 유지
          const defaultOptions = Array.from(select.options).slice(0, 4);
          select.innerHTML = "";

          // 기본 옵션 다시 추가
          defaultOptions.forEach((option) => {
            select.appendChild(option);
          });

          // 서버에서 가져온 폴더 추가 (중복 제외)
          const existingPaths = Array.from(defaultOptions).map(
            (opt) => opt.value
          );

          folders.forEach((folder) => {
            if (!existingPaths.includes(folder.path)) {
              const option = document.createElement("option");
              option.value = folder.path;
              option.textContent = folder.name;
              select.appendChild(option);
            }
          });
        }

        // 전역에 할당
        window.updateFolderSelector = updateFolderSelector;

        // 계정 전환 함수
        async function switchAccount(newAccountId) {
          accountId = newAccountId;
          localStorage.setItem("lastUsedAccountId", accountId);
          log(`계정이 변경되었습니다. ID: ${accountId}`);

          // 폴더 목록 다시 로드
          const folders = await window.api.account.getFolders(accountId);
          updateFolderSelector(folders);

          // 이메일 목록 초기화 및 다시 로드
          currentPage = 1;
          selectedEmailUid = null;
          emailDetail.style.display = "none";
          emailListContainer.style.display = "block";
          loadEmails();
        }

        // 이메일 목록 로드 함수 (페이지네이션 적용) - 개선됨
        async function loadEmails() {
          try {
            if (!accountId) {
              // 계정 ID가 없으면 localStorage나 첫 번째 계정에서 가져오기 시도
              const hasAccount = initAccount();

              if (!hasAccount) {
                // 첫 번째 계정 가져오기 시도
                try {
                  const accounts = await window.api.account.getAll();
                  if (accounts.length > 0) {
                    accountId = accounts[0].id;
                    localStorage.setItem("lastUsedAccountId", accountId);
                  } else {
                    log("계정이 없습니다. 먼저 계정을 추가해주세요.");
                    return;
                  }
                } catch (e) {
                  log(
                    "계정 정보를 가져올 수 없습니다. 먼저 계정을 추가해주세요."
                  );
                  return;
                }
              }
            }

            currentFolder = document.getElementById("folder").value;

            // 로딩 표시
            document.getElementById("loading-emails").style.display = "block";
            emailList.innerHTML = "";
            pagination.style.display = "none";

            log(
              `${currentFolder} 폴더에서 이메일 헤더 가져오는 중 (${currentPage} 페이지)...`
            );

            // 새로운 API 호출: 헤더만 페이지별로 가져오기
            const result = await window.api.emails.fetchHeaders({
              accountId: accountId,
              folderPath: currentFolder,
              page: currentPage,
              pageSize: pageSize,
            });

            document.getElementById("loading-emails").style.display = "none";

            // 결과 처리
            const headers = result.headers;
            totalEmails = result.total;

            log(
              `${headers.length}개의 이메일을 가져왔습니다 (총 ${totalEmails}개 중)`
            );

            if (result.cached) {
              log("캐시된 데이터를 사용했습니다.");
            }

            // 이메일 목록 렌더링
            renderEmailHeaders(headers);

            // 페이지네이션 업데이트
            updatePagination();

            // 백그라운드에서 최근 이메일 5개 본문 미리 캐싱 시도
            if (headers.length > 0 && window.api.emails.prefetchRecent) {
              try {
                window.api.emails
                  .prefetchRecent({
                    accountId: accountId,
                    folderPath: currentFolder,
                    count: 5,
                  })
                  .catch((err) => console.error("백그라운드 캐싱 오류:", err));
              } catch (e) {
                console.error("백그라운드 캐싱 API 없음:", e);
              }
            }
          } catch (error) {
            document.getElementById("loading-emails").style.display = "none";
            log("이메일 가져오기 실패: " + error.message);
          }
        }

        // 전역에 할당
        window.loadEmails = loadEmails;

        // 이메일 헤더 렌더링 함수
        function renderEmailHeaders(headers) {
          emailList.innerHTML = "";

          if (headers.length === 0) {
            emailList.innerHTML =
              "<li class='email-item'>이메일이 없습니다.</li>";
            return;
          }

          headers.forEach((header) => {
            const li = document.createElement("li");
            li.className = "email-item";
            li.dataset.uid = header.uid;

            // 읽지 않은 이메일은 강조 표시
            if (!header.isRead) {
              li.classList.add("unread");
            }

            const date = new Date(
              header.receivedDate || header.sentDate || header.date
            );

            li.innerHTML = `
              <div class="email-subject">${
                header.subject || "(제목 없음)"
              }</div>
              <div class="email-sender">From: ${header.sender}</div>
              <div class="email-date">${formatDate(date)}</div>
            `;

            li.addEventListener("click", () => {
              loadEmailDetail(header.uid);
            });

            emailList.appendChild(li);
          });
        }

        // 페이지네이션 UI 업데이트
        function updatePagination() {
          const totalPages = Math.ceil(totalEmails / pageSize);

          if (totalPages <= 1) {
            pagination.style.display = "none";
            return;
          }

          pagination.style.display = "flex";
          document.getElementById("page-info").textContent =
            `${currentPage} / ${totalPages} 페이지`;

          // 이전 페이지 버튼 상태 업데이트
          const prevBtn = document.getElementById("prev-page");
          prevBtn.disabled = currentPage <= 1;

          // 다음 페이지 버튼 상태 업데이트
          const nextBtn = document.getElementById("next-page");
          nextBtn.disabled = currentPage >= totalPages;
        }

        // 이메일 상세 정보 로드 함수
        async function loadEmailDetail(uid) {
          try {
            selectedEmailUid = uid;

            // 이메일 목록 숨기고 상세 화면 표시
            emailListContainer.style.display = "none";
            emailDetail.style.display = "block";

            // 로딩 표시
            document.getElementById("loading-email-detail").style.display =
              "block";
            document.getElementById("email-detail-content").style.display =
              "none";

            log(`이메일 본문 가져오는 중 (UID: ${uid})...`);

            // 새로운 API 호출: 특정 이메일 본문 가져오기
            const email = await window.api.emails.fetchBody({
              accountId: accountId,
              uid: uid,
              folderPath: currentFolder,
            });

            // 로딩 숨김
            document.getElementById("loading-email-detail").style.display =
              "none";
            document.getElementById("email-detail-content").style.display =
              "block";

            // 이메일을 읽음으로 표시
            if (email.id) {
              await window.api.emails.markAsRead({ id: email.id });
            }

            // 상세 정보 렌더링
            document.getElementById("detail-subject").textContent =
              email.subject || "(제목 없음)";
            document.getElementById("detail-sender").textContent =
              `보낸사람: ${email.sender}`;
            document.getElementById("detail-recipient").textContent =
              `받는사람: ${email.recipient}`;

            const date = new Date(
              email.receivedDate || email.sentDate || email.date
            );
            document.getElementById("detail-date").textContent =
              `날짜: ${formatDate(date)}`;

            // 본문 표시 (HTML이 있으면 HTML, 없으면 텍스트)
            const bodyElement = document.getElementById("email-detail-body");
            if (email.bodyHtml) {
              // iframe에 바로 HTML 삽입
              bodyElement.innerHTML = `<iframe id="email-html-frame" style="width:100%; height:400px; border:none;"></iframe>`;
              const iframe = document.getElementById("email-html-frame");

              // 스타일과 컨텐츠 설정
              const iframeDoc = iframe.contentWindow.document;
              iframeDoc.open();
              iframeDoc.write(`
                <html>
                <head>
                    <meta charset="utf-8">
                    <style>
                    body { font-family: Arial, sans-serif; padding: 10px; }
                    img { max-width: 100%; height: auto; }
                    </style>
                </head>
                <body>${email.bodyHtml}</body>
                </html>
              `);
              iframeDoc.close();
            } else {
              bodyElement.textContent = email.body || "(내용 없음)";
            }

            // 첨부파일 표시
            const attachmentList = document.getElementById("attachment-list");
            attachmentList.innerHTML = "";

            if (email.attachments && email.attachments.length > 0) {
              document.getElementById("email-attachments").style.display =
                "block";

              email.attachments.forEach((att) => {
                const li = document.createElement("li");
                li.textContent = `${att.filename} (${formatFileSize(
                  att.size
                )})`;
                attachmentList.appendChild(li);
              });
            } else {
              document.getElementById("email-attachments").style.display =
                "none";
            }

            log("이메일 상세 정보를 불러왔습니다.");

            if (email.cached) {
              log("캐시된 데이터를 사용했습니다.");
            }
          } catch (error) {
            document.getElementById("loading-email-detail").style.display =
              "none";
            log("이메일 상세 정보 가져오기 실패: " + error.message);
          }
        }

        // 앱 시작 시 자동으로 계정 로드
        loadAccounts();

        // 이메일 가져오기
        document
          .getElementById("fetch-emails-btn")
          .addEventListener("click", () => {
            currentPage = 1; // 첫 페이지로 리셋
            loadEmails();
          });

        // 이전 페이지 클릭
        document.getElementById("prev-page").addEventListener("click", () => {
          if (currentPage > 1) {
            currentPage--;
            loadEmails();
          }
        });

        // 다음 페이지 클릭
        document.getElementById("next-page").addEventListener("click", () => {
          const totalPages = Math.ceil(totalEmails / pageSize);
          if (currentPage < totalPages) {
            currentPage++;
            loadEmails();
          }
        });

        // 폴더 변경 이벤트
        document.getElementById("folder").addEventListener("change", () => {
          currentPage = 1; // 폴더 변경 시 첫 페이지로 리셋
          loadEmails();
        });

        // 상세화면에서 목록으로 돌아가기
        document
          .getElementById("close-detail-btn")
          .addEventListener("click", () => {
            emailDetail.style.display = "none";
            emailListContainer.style.display = "block";

            // 이메일 목록 새로고침 (읽음 상태 표시 업데이트)
            loadEmails();
          });

        // 이메일 보내기
        document
          .getElementById("send-email-form")
          .addEventListener("submit", async (e) => {
            e.preventDefault();

            if (!accountId) {
              // 계정 ID 확인
              const hasAccount = initAccount();
              if (!hasAccount) {
                log(
                  "계정이 선택되지 않았습니다. 계정을 선택하거나 추가해주세요."
                );
                return;
              }
            }

            try {
              log("이메일 보내는 중...");

              const emailData = {
                accountId: accountId,
                recipient: document.getElementById("recipient").value,
                subject: document.getElementById("subject").value,
                text: document.getElementById("body").value,
                html: `<p>${document
                  .getElementById("body")
                  .value.replace(/\n/g, "<br>")}</p>`,
              };

              const result = await window.api.emails.send(emailData);

              if (result.success) {
                log("이메일이 성공적으로 전송되었습니다.");
                document.getElementById("send-email-form").reset();
              } else {
                log("이메일 전송 실패: " + result.error);
              }
            } catch (error) {
              log("이메일 전송 실패: " + error.message);
            }
          });

        // 계정 데이터 가져오기 함수를 전역으로 선언
        window.getAccountData = function () {
          return {
            email: document.getElementById("email").value,
            password: document.getElementById("password").value,
            imapHost: document.getElementById("imapHost").value,
            imapPort: parseInt(document.getElementById("imapPort").value),
            smtpHost: document.getElementById("smtpHost").value,
            smtpPort: parseInt(document.getElementById("smtpPort").value),
          };
        };

        // 날짜 포맷 함수
        function formatDate(date) {
          if (!date || isNaN(date)) return "날짜 없음";
          return date.toLocaleString();
        }

        // 파일 크기 포맷 함수
        function formatFileSize(bytes) {
          if (bytes === 0) return "0 Bytes";
          const k = 1024;
          const sizes = ["Bytes", "KB", "MB", "GB", "TB"];
          const i = Math.floor(Math.log(bytes) / Math.log(k));
          return (
            parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i]
          );
        }
      });
    </script>
  </body>
</html>
